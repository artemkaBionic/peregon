machine:
  node:
     version: 7.2.1
  services:
     - docker

general:
  branches:
    only:
      - master

dependencies:
  override:
    - if [ ! -v ENV ] ; then npm install -g gulp bower ; fi
    - if [ ! -v ENV ] ; then gem install sass ; fi
    - if [ ! -v ENV ] ; then npm install ; fi
    - if [ ! -v ENV ] ; then bower install ; fi 
    - if [ ! -v ENV ] ; then gulp build ; fi 
   
test:
  pre:
     - echo "tests"

deployment:
  lab:
    branch: master
    commands:
      - docker login -e $DOCKER_EMAIL -u $DOCKER_USER -p $DOCKER_PASS
      - docker tag basechord/bridge basechord/bridge:lab
      - docker push basechord/bridge:lab
  canary:
    branch: canary
    commands:
      - docker login -e $DOCKER_EMAIL -u $DOCKER_USER -p $DOCKER_PASS
      - docker tag basechord/bridge basechord/bridge:canary
      - docker push basechord/bridge:canary
  canary2:
    branch: canary2
    commands:
      - docker login -e $DOCKER_EMAIL -u $DOCKER_USER -p $DOCKER_PASS
      - docker tag basechord/bridge basechord/bridge:canary2
      - docker push basechord/bridge:canary2
  production:
    branch:  production
    commands:
      - docker login -e $DOCKER_EMAIL -u $DOCKER_USER -p $DOCKER_PASS
      - docker tag basechord/bridge basechord/bridge:production
      - docker push basechord/bridge:production

